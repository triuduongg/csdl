{% extends "base.html" %}

{% block content %}
<h2>Danh sách tài liệu</h2>
<a href="{% url 'documents:upload_document' %}" class="btn btn-primary">Upload tài liệu mới</a>

<form method="get" action="{% url 'documents:search_documents' %}" class="mb-3">
    <div class="input-group">
        <input type="text" name="q" placeholder="Tìm kiếm tài liệu..." class="form-control">
        <button type="submit" class="btn btn-outline-secondary">Tìm kiếm</button>
    </div>
</form>

{% if documents %}
<table class="table table-striped">
    <thead>
        <tr>
            <th>Tiêu đề</th>
            <th>Mô tả</th>
            <th>Upload bởi</th>
            <th>Ngày upload</th>
            <th>Hành động</th>
        </tr>
    </thead>
    <tbody>
        {% for document in documents %}
        <tr>
            <td>
                <strong>{{ document.title }}</strong>
            </td>
            <td>
                {% if document.description %}
                    {{ document.description|truncatechars:100 }}
                {% else %}
                    <em class="text-muted">Không có mô tả</em>
                {% endif %}
            </td>
            <td>{{ document.uploaded_by.username }}</td>
            <td>{{ document.upload_date|date:"d/m/Y H:i" }}</td>
            <td>
                <a href="{% url 'documents:download_document' document.pk %}" class="btn btn-sm btn-success">Tải xuống</a>

                <!-- Show Edit/Delete buttons for admin or document uploader -->
                {% if document.uploaded_by == user or user.userprofile.is_admin %}
                    <a href="{% url 'documents:edit_document' document.pk %}" class="btn btn-sm btn-warning">Sửa</a>
                    <a href="{% url 'documents:delete_document' document.pk %}" class="btn btn-sm btn-danger">Xóa</a>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<div class="alert alert-info">
    <strong>Thông báo:</strong> Chưa có tài liệu nào được upload.
</div>
{% endif %}
{% endblock %}
